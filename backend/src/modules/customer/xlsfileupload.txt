npm install multer xlsx


Create your upload + seed route

Create a new file:
src/modules/customer/customer.routes.js

import express from "express";
import multer from "multer";
import xlsx from "xlsx";
import Customer from "./customer.model.js";

const router = express.Router();

// üü¢ Multer setup to store file temporarily
const upload = multer({ dest: "uploads/" });

// üü¢ Upload Excel + insert customers
router.post("/uploadExcel", upload.single("file"), async (req, res) => {
  try {
    if (!req.file) {
      return res.status(400).json({ error: "No file uploaded" });
    }

    console.log("üìÇ File uploaded:", req.file.path);

    // Step 1: Read Excel file
    const workbook = xlsx.readFile(req.file.path);
    const sheetName = workbook.SheetNames[0];
    const sheetData = xlsx.utils.sheet_to_json(workbook.Sheets[sheetName]);

    console.log(`üìä Found ${sheetData.length} rows in Excel`);

    // Step 2: Insert each customer
    let added = 0;
    for (const row of sheetData) {
      const {
        customer_name,
        pincode,
        phone,
        old_balance,
        advance,
        credit_limit,
        available_limit,
        balance,
        gst_pan_number,
        status,
        createdBy,
      } = row;

      if (!customer_name || !phone) continue;

      // Check if customer exists
      const existing = await Customer.findOne({ where: { phone } });
      if (existing) {
        console.log(`‚ö†Ô∏è Customer already exists: ${customer_name}`);
        continue;
      }

      await Customer.create({
        customer_name,
        pincode,
        phone,
        old_balance: old_balance || 0,
        advance: advance || 0,
        credit_limit: credit_limit || 0,
        available_limit: available_limit || 0,
        balance: balance || 0,
        gst_pan_number,
        status: status || "active",
        createdBy: createdBy || "system",
      });
      added++;
    }

    return res.json({
      message: `‚úÖ Successfully added ${added} customers`,
      total: sheetData.length,
    });
  } catch (err) {
    console.error("‚ùå Error uploading Excel:", err);
    res.status(500).json({ error: "Server error while uploading Excel" });
  }
});

export default router;

‚úÖ 3Ô∏è‚É£ Hook it into your main backend

In src/app.js (or wherever you configure your routes):

import express from "express";
import customerRoutes from "./modules/customer/customer.routes.js";

const app = express();

app.use(express.json());
app.use("/api/customers", customerRoutes);

‚úÖ 4Ô∏è‚É£ Upload in Postman

Request type:
POST http://localhost:5001/api/customers/uploadExcel

Body:

Select Body ‚Üí form-data

Add a key named file

Type ‚Üí File

Choose your Excel file (like customers.xlsx)

Example:

KEY	TYPE	VALUE
file	File	choose your .xlsx file
‚úÖ 5Ô∏è‚É£ Excel format (headers)

Your Excel must have these columns (header row):

customer_name	pincode	phone	old_balance	advance	credit_limit	available_limit	balance	gst_pan_number	status	createdBy
‚úÖ 6Ô∏è‚É£ Response example

You‚Äôll get something like:

{
  "message": "‚úÖ Successfully added 45 customers",
  "total": 50
}